<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">

    <title>Movies</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ephesis&display=swap');


        body{
            background-color: #091353;
        }
        #movies{
            display: grid;
            grid-template-columns: repeat(4,23%);
            width: 90%;
            margin:100px auto;
            justify-content: center;
            justify-items: center;


        

        }
        #movies>div{
            width: 250px;
            margin-top: 30px;
            background-color: #9D84B7;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.7s;
            position: relative;
            
        }
         #movies>div:hover{
                        transform: scale(1.1);
        }
        #movies >div>img{
               height: 250px;
               width: 100%;
        }
         #movies >div>p{
               padding-left: 10px;
               color: #D5D5D5;
               font-size: large;
               font-family: Verdana, Geneva, Tahoma, sans-serif;
                  padding-right: 10px;
                  margin: 0 ;
        }

        #input{
            width: 90%;
            margin: auto;
            text-align: center;  
            /* margin-top: 100px; */
            background-color: #8c73a795;
            height: 100px;
            border-radius: 10px;
            line-height: 100px;
            position: relative;
            display: flex;
            align-items: center;
    justify-content: center;


        }
        #movie{
                height: 50px;
                width: 600px;
                border: none;
                background-color: beige;
                padding-left: 20px;
                border-radius: 10px;
                font-size: 20px;
                
        }
        /* #input>button{
             height: 50px;
                width: 150px;
                border-radius: 50px;
                margin-left: 50px;
                  transition: 0.5s;
                font-size: large;
        }
        #input>button:hover{
            transform: scale(1.1);

        } */
        #no-result{
             margin-top: 20px;    
          

        }
        #no-result>img{
           width: 90%;
           height: 600px;
           display: block;
           margin: auto;
           border-radius: 10px;
        }
       h1{
           text-align: center;
           color: #B2F9FC;
           font-size: 70px;
           font-family: 'Ephesis', cursive;
           letter-spacing: 10px;
           margin: 0;
       }
       /* i{
           position: absolute;
           top: 1%;
           right: 1%;
           font-size: 50px;
           color: white;
       } */
       #search{
           margin:  0 auto;
           width: 400px;
           position: absolute;
           background-color: #D5D5D5;
         left: 20%;
         z-index: 1;
         max-height: 500px;
         overflow-y: scroll;
          top: 100px;
          display: flex;
           flex-direction: column;
           border: none;
           box-shadow: 0 10px 10px black;
           border-radius: 10px;
         
       }
       #search>div>img{
           height: 125px;
           
       }
    
       #search>div{
        margin: 10px;   
        display: flex; 
        gap: 20px;
       }
       #search>div>p{
           font-size: 24px;
           font-family: Verdana, Geneva, Tahoma, sans-serif;
       }
       @media only screen and (max-width:1200px) {

         #movies{
            grid-template-columns: repeat(3,30%);
        }
           
       }
       @media only screen and (max-width:900px) {

         #movies{
            grid-template-columns: repeat(2,40%);
        }
           
       }
       #detail{
            width: 90%;
            margin: auto;
            background-color: #8c73a795;
            border-radius: 10px;
            margin-top: 50px;
            display: grid;
            grid-template-columns:  30% 50%;
            grid-gap: 20px;
            overflow:hidden;
       }
       #detail>div>img{
           height: 400px;
           width: 100%;
       }
       #detail>div>p{
           font-size: 25px;
       }
       #popular{
            text-align: center;
           color: #B2F9FC;
           font-family: 'Ephesis', cursive;
           font-size: 40px;
       }


       /*  */
            #signin{
        border: 1.5px solid black;
        border-radius: 10px;
        background-color: #B2F9FC;
        color: black;
        height: 50px;
        width: 150px;
        text-align: center;
        display: flex;
        align-items: center;
        margin-top: 5px;
        margin-left: 100px;
        line-height: 40px;
        font-weight: bolder;
        translate:all 1s;

      }
       #signin:hover{
           transform: scale(1.1);
       }
      .fa-user-circle{
        line-height: 10px;
        font-size: 20px;
        margin: 4px 10px 0 20px;
      }

      .login,.signup{
       
        height: 600px;
        width: 500px;
        position: absolute;
            background-color: #9D84B7;
        border-radius: 20px;
        z-index: 2;
        top: 15%;
        left: 35%;
        box-shadow: 10px 10px 10px black;
        display: none;
        flex-direction: column;
        
        
      }
      .login input[type="submit"],.signup input[type="submit"]{
           border: 1.5px solid black;
        border-radius: 10px;
        background-color: #B2F9FC;
        color: black;
        height: 50px;
        width: 150px;
      }
      .login h1{
        text-align: center;
        margin: 10px;
        margin-top: 150px;

      }
      .login input{
        margin: 10px auto;
        height: 40px;
        width: 300px;
        padding-left: 10px;
        font-size: 20px;
        
      }
       .login h3{
         text-align: center;
         cursor: pointer;
         margin-top: 10px;
       }
        .signup input{
        margin: 10px auto;
        height: 40px;
        width: 300px;
        padding-left: 10px;
        font-size: 20px;
        
      }
       .signup h3{
         text-align: center;
         cursor: pointer;
         margin-top: 10px;
       }
       .active{
         display: flex;
       }
        
    </style>
</head>
<body>
    <h1 onclick="returnToHome()">Info.Movies</h1>
   <div id="input">
        <input type="text" id="movie" placeholder="Search Movie" oninput="debounce(searchMovie,1000)">
        <div id="signin" onclick="login_page()"><i class="far fa-user-circle"></i><p>SIGN IN</p></div>

        <div id="search" ></div>
        <!-- login -->
    </div>
        <div class="login"  >
        <h1>Login</h1>
        <input type="text" id="user"placeholder="username">
        <input type="password" id="pass" placeholder="password">
        <input type="submit" value="login" onclick="login()">
        <h3 onclick="signup_page()">Signup</h3>
      </div>
<!-- signup -->
      <div class="signup">
        <h1>Signup</h1>
          <input type="text" id="name" placeholder="name">
    <input type="email" id="email" placeholder="email">
    <input type="password" id="password" placeholder="Pass">
    <input type="text" id="userName" placeholder="user Name">
    <input type="text" id="mobile" placeholder="Mob No">
    <input type="text" id="description" placeholder="Desc">
     <input type="submit" value="sign-up" onclick="signup()">
      </div>
    
   <!-- <div id="no-result"> -->

   </div>
   <div id="detail">

   </div>
   <div id="popular">Popular Movies</div>
   <div id="category">
        
   </div>
       <div id="movies">
           <!-- all the movies in the form of a grid  -->

       </div>
    <script>
        




        //get movie on search 
async function getMovie(movie_name){
    let res = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=d96691ff21105442b23e5deb93e504f5&query=${movie_name}`);
    //c8cb72f9
    let data = await res.json();
    // console.log(data.Search)
    //if no data recieved
    // console.log(data)
    console.log(data)

    if(data.results===undefined){
       let parent = document.getElementById("search");
       parent.innerHTML = null;
       parent.innerHTML = `<h1> Not Found</h1>`;
  
    }else{

     let parent = document.getElementById("search");
     parent.innerHTML = null;
    console.log(data.results);
    
       showSearch(data.results);
    
    }

}

async function showPopular(){
    let res = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=d96691ff21105442b23e5deb93e504f5&sort_by=popularity.desc`);
    
    let data = await res.json();

    showMovie(data.results)

}
showPopular();



function showMovie(movies){
    let parent = document.getElementById("movies");
    parent.innerHTML = null;
   


    movies.forEach(function(movie){
         let div = document.createElement("div");
         div.setAttribute("class","movie");

         let img = document.createElement("img");
         img.src = "https://image.tmdb.org/t/p/w500"+movie.poster_path;
        //  img.alt ="no image available";

         let title = document.createElement("p");
         title.innerText ="Title-" +movie.title;

         let year = document.createElement("p");
         year.innerText = "Year-"+movie.release_date.slice(0,4);


         let imdb = document.createElement("p");
         imdb.innerText = "imdb rating-"+ movie.vote_average;

         if(movie.vote_average > 8.5){
             let recom = document.createElement("p");
             recom.innerHTML =` <i class="fas fa-thumbs-up"></i> `;
            
             div.append(img,title,year,imdb,recom);

         }else{

             div.append(img,title,year,imdb);
         }
          //add event listener 
         div.addEventListener("click",function(){
          console.log(movie);
          showDetail(movie);
          //colapse the search div

              let parent = document.getElementById("search");
       parent.innerHTML = null;

         })

         parent.append(div);



    });
    
}
let timeID;
//applying debouncing to search funciton
function debounce(func,delay){

    if(timeID){
        clearTimeout(timeID);
    }



    timeID = setTimeout(function(){
        func();

    },delay);

}
//input to this function form search
function searchMovie(){


    let movie = document.getElementById("movie").value;
    console.log(movie)
    if(movie =="" || movie.length<3){
            let parent = document.getElementById("search");
       parent.innerHTML = null;
return ;
    }else{
        getMovie(movie);
    }


}



function showSearch(movies){
    let parent = document.getElementById("search");
    parent.innerHTML = null;

    movies.forEach(function(movie){
 let div = document.createElement("div");
         div.setAttribute("class","searchMovie");

         let img = document.createElement("img");
         img.src = "https://image.tmdb.org/t/p/w500"+movie.poster_path;

         let title = document.createElement("p");
         title.innerText =movie.title;
             

         div.append(img,title);
         parent.append(div);

         //add event listener 
         div.addEventListener("click",function(){
          console.log(movie);
          showDetail(movie);
          //colapse the search div

              let parent = document.getElementById("search");
       parent.innerHTML = null;

         })
        
    });

}


//show detail on individual movie

function showDetail(movie){
let parent = document.getElementById("detail");
parent.innerHTML = null;
parent.style.backgroundImage = "https://image.tmdb.org/t/p/w500"+movie.backdrop_path;

let div1 = document.createElement("div");

let img = document.createElement("img");
img.src = "https://image.tmdb.org/t/p/w500"+movie.poster_path;
 
div1.append(img);

let div2 = document.createElement("div");

let title = document.createElement("h2");
title.innerText = movie.title;

let date = document.createElement("p");
date.innerHTML = movie.release_date;

let overview = document.createElement("p");
overview.innerText = movie.overview;

div2.append(title,date,overview);

parent.append(div1,div2)
          window.location.href="#detail";

}













  //login

  function login_page(){
  
  let login = document.querySelector(".login");
  login.classList.add("active");
  document.querySelector(".signup").classList.remove("active");



  }

  function signup_page(){
     document.querySelector(".login").classList.remove("active");

     let signup =document.querySelector(".signup");

  signup.classList.add("active");

  }

  //function signup
  function signup(){
    let new_user = {
      name :document.getElementById("name").value,
        email : document.getElementById("email").value,
        password:document.getElementById("password").value,
        username :document.getElementById("userName").value,
        mobile : document.getElementById("mobile").value,
        description : document.getElementById("description").value

    }

    new_user = JSON.stringify(new_user);

    fetch("https://masai-api-mocker.herokuapp.com/auth/register",{
      method:"POST",
      body:new_user,
       headers:{

            'Content-Type':'application/json',
        },

    })
    .then((res)=>{
      return res.json();
    }).then((res)=>{
      if(res.message === "Registration Success") 
      { alert(res.message)
        login_page();
      }
      else{
        alert(res.message)
      }
      
    }).catch((err)=>{
      console.log(err)
    })

         document.getElementById("name").value =null;
         document.getElementById("email").value =null;
         document.getElementById("password").value =null;
         document.getElementById("userName").value =null;
         document.getElementById("mobile").value =null;
         document.getElementById("description").value=null;
   
  }


  function login(){
      let user = {
        password:document.getElementById("pass").value,
        username :document.getElementById("user").value,

    }

    let use = JSON.stringify(user);

    fetch("https://masai-api-mocker.herokuapp.com/auth/login",{
      method:'POST',
      body:use,
      headers:{
        'Content-Type':'application/json'
      }
    })
    .then((res)=>{
      return res.json();

    }).then((res)=>{
      console.log(res);
      if(!res.error){
          usergetdetail(user.username,res.token)

      }else{
        alert(res.message)
      }
    })

  }
  function usergetdetail(username,token){

    document.querySelector(".login").classList.remove("active");

    fetch(`https://masai-api-mocker.herokuapp.com/user/${username}`,{
    
        headers:{
            'Content-Type':'application/json',
            Authorization:`Bearer ${token}`,

        }
    })
    .then((res)=>{
        return res.json();
    }).then((res)=>{
        document.querySelector("#signin>p").innerText = res.username;
        document.querySelector("#signin").style.border = "none";
    });

  }





    </script>
</body>
</html>